@using System.Security.Claims
@model InvoiceDetailModel
@{
    Tour tour = ViewBag.tour;
    var total = 0;
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link rel="stylesheet" href="~/css/orderdetails.css">
<!-- Thong tin goi nho -->
<div class="goinho">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="thongtin">
                    <small>Trang chủ > </small>
                    <small>Đặt tour</small>
                </div>
            </div>
        </div>
    </div>
</div> <!-- the end goi nho -->
<!-- Section -->

<div class="orderdetails">
    <div class="container">
        <div class="row">
            @if (tour != null)
            {
                <div class="imagechinhsuachieucao">
                    <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4 imagesleft">
                        <img src="https://localhost:44384/images/@tour.Image">
                    </div>
                </div>
                <!-- the end images -->
                <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8 tableright">
                    <div class="tabletop">
                        <p class="contenttabletop">
                            @tour.Name
                        </p>
                    </div>
                    <div class="tablebottom">
                        <p>
                            Mã tour: &nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <small class="sotabletop">@tour.TourId.Substring(0,50)</small>
                        </p>
                        <p>
                            Thời gian: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
                            <small class="sotabletop">@tour.Schedule</small>
                        </p>
                        <p>
                            Giá: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <small class="sotabletop">@tour.Price đ</small>
                        </p>
                        <p>
                            Ngày khởi hành: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <small class="sotabletop">@tour.StartDate.Date Ngày khác</small>
                        </p>
                        <p>
                            Nơi khởi hành: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <small class="sotabletop">@tour.StartPlace</small>
                        </p>
                        <p>
                            Số chỗ còn nhận: &nbsp;&nbsp;&nbsp;&nbsp;
                            <small class="sotabletop">@tour.Quantity</small>
                        </p>
                    </div>
                </div>
            }
        </div>
        <!-- the end row 1-->
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="phiphatsinh">
                    <p>
                        Các khoản phí phát sinh (nếu có) như: phụ thu dành cho khách nước ngoài, việt kiều; phụ thu phòng đơn; phụ thu chênh lệch giá tour… Nhân viên Du Lịch Việt sẽ gọi điện thoại tư vấn cho quý khách ngay sau khi có phiếu xác nhận booking. (Trong giờ hành chính)
                        Trường hợp quý khách không đồng ý các khoản phát sinh, phiếu xác nhận booking của quý khách sẽ không có hiệu lực.
                    </p>
                </div>
                <div class="gachduoiphi">
                    <hr>
                </div>
            </div>
        </div>
        <!-- the end row 2-->
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12
          banggiatourchitiet text-center">
                <p>
                    BẢNG GIÁ TOUR CHI TIẾT
                </p>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 tablechitietgia">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th scope="col" class="text-right">Loại giá/độ tuổi</th>
                            <th scope="col" class="text-right">Người lớn(từ 12 tuổi)</th>
                            <th scope="col" class="text-right">Trẻ em theo cùng</th>
                            <th scope="col" class="text-right">Khác</th>
                        </tr>
                    </thead>
                    <tbody class="text-right">
                        <tr>
                            <th scope="row" class="text-right">Giá</th>
                            <td><p class="sotabletop">@tour.Price đ</p></td>
                            <td><a href="#" title="">Xem tại đây</a></td>
                            <td>không</td>
                        </tr>
                        <tr>
                            <th scope="col" class="text-right">Phụ thu nước ngoài</th>
                            @if (tour.Price > 0)
                            {
                                var gia = (@tour.Price * (decimal)0.05);
                                <td>@gia đ</td>
                            }
                            <td>0 đ</td>
                            <td>không</td>
                        </tr>
                        <tr>
                            <th scope="col" class="text-right">Phụ thu phòng đơn</th>
                            @if (tour.Price > 0)
                            {
                                var gia = (@tour.Price * (decimal)0.1);
                                <td colspan="3" class="text-center">@gia đ</td>
                            }
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- th end row 3 -->
        <form asp-action="Create" asp-controller="Invoice" method="post">
            <div asp-validation-summary="All" class="text-danger"></div>
            @if (tour != null)
            {
                <div class="row">

                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12
                banggiatourchitiet text-center">
                        <p>
                            THÔNG TIN LIÊN HỆ
                        </p>
                        <small style="color:red; font-size: 23px;">@ViewBag.ErrorRegister</small><br />
                    </div>
                    <div class="formkhoangcanh">
                        <input type="hidden" asp-for="InvoiceId" />
                        <input type="hidden" id="tongcong" asp-for="Price" value="@tour.Price" />
                        <small style="color: red; font-size: 13px;">@ViewBag.ErrPrice</small>
                        <input type="hidden" asp-for="TourId" value="@tour.TourId" />
                        <input type="hidden" asp-for="MemberId" value="@User.FindFirstValue(ClaimTypes.NameIdentifier)" />
                        <small style="color:red; font-size: 13px;">@ViewBag.ErrorName</small>
                        <div style="color:red; font-size:13px" asp-validation-summary="ModelOnly"></div>
                        <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4 thongtinduoi">
                            <div class="form-group">
                                <input type="text" asp-for="FullName" class="form-control" placeholder="Họ và tên">
                                <span style="color:red; font-size:13px" asp-validation-for="FullName" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4 thongtinduoi">
                            <div class="form-group">
                                <input type="text" asp-for="Phone" class="form-control" placeholder="Số điện thoại">
                                <span style="color:red; font-size:13px" asp-validation-for="Phone" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4 thongtinduoi">
                            <div class="form-group">
                                <input type="text" name="email" asp-for="Email" class="form-control" placeholder="Email">
                                <span style="color:red; font-size:13px" asp-validation-for="Email" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4 thongtinduoi">
                            <div class="form-group">
                                <input type="text" asp-for="Address" class="form-control" placeholder="Địa chỉ">
                                <span style="color:red; font-size:13px" asp-validation-for="Address" class="text-danger"></span>
                                <small style="color:red; font-size:13px;">@ViewBag.ErrorAddress</small>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8 thongtinduoi">
                            <div class="form-group">
                                <input style="color:red; font-size:13px" type="text" asp-for="Description" class="form-control" placeholder="Ghi chú">
                            </div>
                        </div>

                        <!-- the end form thong tin person -->
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12
          banggiatourchitiet text-center">
                            <p>
                                THÔNG TIN THAM GIA
                            </p>
                        </div>
                        <div class="khoangcachpersonthamgia">
                            <div>
                                <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                    <div class="personprice">
                                        <p>
                                            Số người tham gia
                                        </p>
                                    </div>
                                    <div class="form-group">
                                        <input type="number" id="sl" value="1" min="1" max="@tour.Quantity" asp-for="Quantity" class="form-control">
                                        <span style="color:red; font-size:13px" asp-validation-for="Quantity"></span>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                    <div class="personprice">
                                        <p>
                                            Phụ thu phòng đơn
                                        </p>
                                    </div>
                                    <div class="form-group">
                                        <select id="phu" onchange="phongDon(this);" asp-for="PaymentMore" class="form-control">
                                            <option value="False">Không</option>
                                            <option value="True">Có</option>

                                        </select>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                                    <div class="personprice">
                                        <p>
                                            Số lượng phòng đơn
                                        </p>
                                    </div>
                                    <div class="form-group">
                                        <input type="number" id="don" value="0" min="0" asp-for="QuantityDepartment" class="form-control" disabled>
                                        <span style="color:red; font-size:13px" asp-validation-for="QuantityDepartment"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- the end form person tha gia -->

                        <div class="tonggiatridonhang pull-right">
                            <p>Tổng giá trị : <small class="giachot" id="showtongcong">@tour.Price.ToString("C", System.Globalization.CultureInfo.GetCultureInfo("vi-VN")) </small></p>
                        </div>

                    </div>

                </div>
            }

            <!-- the end row 4 -->
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12
          banggiatourchitiet text-center">
                    <p>
                        PHƯƠNG THỨC THANH TOÁN
                    </p>
                </div>
                <div class="khoangcachphuongthucthanhtoan">
                    <div>
                        <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                            <div class="form-group">
                                <input type="radio" asp-for="Payment" value="0">
                                &nbsp; &nbsp;
                                <label for="phuongthucthanhtoan">
                                    Thanh toán qua Mastercard
                                </label>

                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                            <div class="form-group">
                                <input type="radio" value="1" asp-for="Payment" checked>
                                &nbsp; &nbsp;
                                <label for="phuongthucthanhtoan">
                                    Thanh toán qua ngân hàng
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                            <div class="form-group">
                                <input type="radio" value="2" asp-for="Payment">
                                &nbsp; &nbsp;
                                <label for="phuongthucthanhtoan">
                                    Thanh toán qua ví điện tử
                                </label>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 hoanthanhthanhtoan text-center">
                            <button class="btn btn-success">HOÀN THÀNH</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!-- the end row 5 -->
    </div>
</div>
@if (tour != null)
{
    <script>
        const element = document.getElementsByClassName('#sl');

        function handleKeypress(e) {
            element[0].value = '';
        }

        element[0].addEventListener('keyup', handleKeypress);
    </script>
    <script>
        const element = document.getElementsByClassName('#don');

        function handleKeypress(e) {
            element[0].value = '';
        }

        element[0].addEventListener('keyup', handleKeypress);
    </script>
    <script>
        @*$('#phu').click(function () {
            $("#don").prop("disabled", false);
        });*@

        function phongDon(obj) {
            var giatri = obj.value;
            console.log(giatri);
            if (giatri == 'True') {
                $("#don").prop("disabled", false);
            }
            else {
                $("#don").prop("disabled", true);
            }
        }

    </script>
    <script>
         var total = 0;
        $('#sl').change(function () {
            var sluongmoi = $('#don').val();
            console.log(sluongmoi);
            var sluong = $(this).val();
            console.log(sluong);
            total = (sluong * @tour.Price) + (sluongmoi * @tour.Price * 0.1);
            $('#tongcong').val(total);
            $('#showtongcong').html(total);
        });
        $('#don').change(function () {
            var sluong = $('#sl').val();
            console.log(sluong);
            var totalmoi = 0;
            sluongmoi = $(this).val();
            console.log(sluongmoi);
            totalmoi = (sluong * @tour.Price) + (sluongmoi * @tour.Price * 0.1);
            $('#tongcong').val(totalmoi);
            $('#showtongcong').html(totalmoi);
        });
       @* var total = 0;
        $('#sl').change(function (){
            var sluong = $(this).val();
            console.log(sluong);
            total = sluong * @tour.Price;
            $('#tongcong').val(total);
            $('#showtongcong').html(total);
        });
         $('#don').change(function (){
            sluongmoi = $(this).val();
             console.log(sluongmoi);
            var total = sluong * @tour.Price;
            $('#tongcong').val(total);
            $('#showtongcong').html(total);
        });*@
    </script>
}
@*@if (tour != null)
    {
        <script>
            $('#sl').change(function (){
                var sluong = $(this).val();
                console.log(sluong);
                var total = sluong * @tour.Price;
                $('#tongcong').val(total);
                $('#showtongcong').html(total);
            });
        </script>
    }
*@